//release 20180213-1114

("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery)(function(){("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery)("body").append('<div class="vishnu-container" style="display:none;"></div><div id="vishnu-button" style="display:none;"></div>')}),function(e){function t(){return!i.debugMode&&!i.testMode}var i=vishnuSettings.loader;e.fn.vishnu.uuid=i.uuid,e.fn.vishnu.View.prototype.isMobile=vishnuSettings.clientConfig.isMobile,e.fn.vishnu.View.prototype.classUserMessage=".vishnu-user-message",e.fn.vishnu.View.prototype.classInfMessage=".vishnu-inf-message",e.fn.vishnu.View.prototype.defaultInputText="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 \u0432\u043e\u043f\u0440\u043e\u0441",e.fn.vishnu.View.prototype.idButton="#vishnu-button",e.fn.vishnu.View.prototype.idResponse="#vishnu-response",e.fn.vishnu.View.prototype.idRequestWrap="#vishnu-request-wrap",e.fn.vishnu.View.prototype.idButtonText="",e.fn.vishnu.View.prototype.isScrollable=!1,e.fn.vishnu.View.prototype.response_scrolled=null,e.fn.vishnu.View.prototype.response_mCSBcontainer=null,e.fn.vishnu.View.prototype.requestIsScrollable=!1,e.fn.vishnu.View.prototype.requestLineHeightDy=20,e.fn.vishnu.View.prototype.request_scrolled=null,e.fn.vishnu.View.prototype.request_mCSBcontainer=null,e.fn.vishnu.VishnuEvent.srvReq={WCMD_RESULT:"SRVREQ ea62109e-fbb0-40c2-b7bc-b34be8a1fe0f WCMD_RESULT",OPERATOR_SESSION_CLOSED:"SRVREQ 48f67fe9-3872-4bf6-8a6b-d3899b24b04a OPERATOR_SESSION_CLOSED",ATTACHMENT:"SRVREQ 56d8d1ed-45f7-489b-9ec8-4c20a0edc8de ATTACHMENT"},e.fn.vishnu.VishnuEvent.WCMD_RESULT_def={w_cmd:null,w_result:"ok"},e.fn.vishnu.Event.prototype.NOTIFICATION="bffaa961-9ad3-4ecd-9254-f9e2fc06f28c",e.fn.vishnu.Model.prototype.notifyClickID=null,e.fn.vishnu.settings[e.fn.vishnu.uuid]={debugMode:!t(),Model:{params:{vars:void 0!==vishnuSettings.clientConfig?vishnuSettings.clientConfig:""}},Logger:{enabled:!1},View:{noCharacter:!0,isScrollable:!0,requestIsScrollable:!1,template:'<div id="vishnu-close"></div><div id="vishnu-main-wrap"><div id="vishnu-header">\u0412\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442</div><div id="vishnu-view"></div><div id="vishnu-dialog"><div id="vishnu-response"><div id="vishnu-response-wrap"><div id="vishnu-response-text"></div></div></div><div id="vishnu-request"><div id="vishnu-request-wrap"><textarea id="vishnu-input" spellcheck="false" maxlength="1000"></textarea></div><button id="vishnu-send"></button></div></div></div>',idResponseText:"#vishnu-response-text",idButton:"#vishnu-button",flashAvailable:!1,animationMask:e.fn.vishnu.resourcesProvider.getImagesDir()+"anim_#.gif",animationDurations:{2:2480,3:2920,4:3320,5:2760,6:4920,7:5880,8:5960,9:2560,10:3960},gagsEnabled:!0,gagTimeout:2e4,gagAnimations:[2,8],defaultInputText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0432\u043e\u043f\u0440\u043e\u0441",hideAuto:!1},Net:{type:e.fn.vishnu.ConnectionType.SYNCPOST,url:t()?"https://biz.nanosemantics.ru/api/2.1/json/":"http://biz-debug.nanosemantics.ru/api/2.1/json/"},Rate:{enabled:!0,template:'<div id="vishnu-rate" style="display:none;"><div id="vishnu-rate-text">\u041f\u043e\u043c\u043e\u0433 \u043b\u0438 \u0432\u0430\u043c \u043e\u0442\u0432\u0435\u0442?</div><div id="vishnu-rate-yes">\u0414\u0430</div><div id="vishnu-rate-no">\u041d\u0435\u0442</div><div id="vishnu-rate-close"></div><div id="vishnu-rate-details"><a href="#" rel="3"><span class="vishnu-list-circle"></span>\u042f \u0441\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u043b(-\u0430) \u043f\u0440\u043e \u0434\u0440\u0443\u0433\u043e\u0435</a><br /><a href="#" rel="2"><span class="vishnu-list-circle"></span>\u042f \u043d\u0435 \u043f\u043e\u043d\u044f\u043b(-\u0430) \u043e\u0442\u0432\u0435\u0442</a><br /><a href="#" rel="1"><span class="vishnu-list-circle"></span>\u041e\u0442\u0432\u0435\u0442 \u043d\u0435 \u0440\u0435\u0448\u0438\u043b \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443</a></div><div id="vishnu-rate-thanks"></div></div>'},Tracker:{account:"",accounts:{GA:"UA-39462030-43",YA:t()?"15221083":"46460022"}},History:{enabled:!0,useFlashStorage:!1,useLocalStorage:!0},LCEModel:{enabled:!0,scriptEvAdapterLocation:(t(),"adapter.js"),sendLogWithRequiresOperator:!1,queueTimeout:18e4,idOperatorName:"#vishnu-header",TEHmessage:{noOperators:"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0432\u0441\u0435 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b \u0437\u0430\u043d\u044f\u0442\u044b.",operatorIsTyped:"\u041f\u0435\u0447\u0430\u0442\u0430\u0435\u0442 ",queueTime:"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043d\u0435 \u0432\u0437\u044f\u043b \u0434\u0438\u0430\u043b\u043e\u0433 \u0438\u0437 \u043e\u0447\u0435\u0440\u0435\u0434\u0438",operatorChange:"\u0412\u0430\u0448 \u0434\u0438\u0430\u043b\u043e\u0433 \u043f\u0435\u0440\u0435\u0434\u0430\u043d \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0443 <strong>%NAME</strong>",infChange:"\u0414\u0438\u0430\u043b\u043e\u0433 \u043f\u0435\u0440\u0435\u0434\u0430\u043d \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u043c\u0443 \u043a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442\u0443 <strong>%NAME</strong>",operatorProcess:"<img src='"+e.fn.vishnu.resourcesProvider.getBaseUrl(e.fn.vishnu._internalSettings.defaultBaseUrl)+"images/circle_anim.gif'> \u0421\u043e\u0435\u0434\u0438\u043d\u044f\u044e \u0441 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u043c",dialogEnd:"",file:"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043d \u0444\u0430\u0439\u043b: %FILE",log:"\u0414\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435: %FILE"},uploadEnable:!1,showRateBeforeQuit:!1,debugIntergtaion:!1}};var s=e.fn.vishnu.Vishnu.prototype.init;e.fn.vishnu.Vishnu.prototype.init=function(t){e.fn.vishnu.instancesCount=0;var i=this;$this=this,this.on(e.fn.vishnu.VishnuEvent.DRAW,function(){var t=$this.getView();if(e(t.idButton).text(t.idButtonText),head.ready(function(){$this.log("LOADER: \u0432\u0441\u0435 \u0441\u0442\u0438\u043b\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b"),e(t.idButton).removeAttr("style"),t.adaptiveResize()}),t.isScrollable&&(t.response_scrolled=e(t.idResponseText,t.container),e(t.idResponseText,t.container).mCustomScrollbar({axis:"y",autoDraggerLength:!1,theme:"vishnu",callbacks:{onCreate:function(){var i=e(this).data("mCS").idx;t.response_mCSBcontainer=e("#mCSB_"+i+"_container",t.container)}}})),t.requestIsScrollable){t.request_scrolled=e(t.idRequestWrap,t.container);var i=parseInt(e(".textarea-wrapper textarea").css("line-height"));e(t.idInput,t.container).after('<div class="textarea-clone"><div>'),e(t.idRequestWrap,t.container).mCustomScrollbar({axis:"y",scrollInertia:0,snapAmount:i,mouseWheel:!0,autoHideScrollbar:!1,callbacks:{onCreate:function(){var i=e(this).data("mCS").idx;t.request_mCSBcontainer=e("#mCSB_"+i+"_container",t.container)}}})}$this.Cookie.hasCookie("upload-enabled")&&1==$this.Cookie.getCookie("upload-enabled")&&$this.getModel().enableUpload()}),this.on(e.fn.vishnu.VishnuEvent.HISTORY_LOADED,function(t,s){if(s&&void 0!==s&&$this.getView().isScrollable){for(var n,o=e($this.getView().response_mCSBcontainer,$this.getView().container).find(".vishnu-last-message"),a=!1,r=0;r<s.length;r++)if(s[r]&&void 0!==s[r])if(s[r].inf&&void 0!==s[r].inf){if(n=$this.getView().replaceMarks(s[r].inf),r==s.length-1&&void 0!==o.html()&&null!==o.html()&&n.replace(/<\/?[^>]+>/g,"")==o.html().replace(/<\/?[^>]+>/g,""))break;$this.getView().addInfMessage(n,0),a=!0}else s[r].user&&void 0!==s[r].user&&(n=s[r].user,$this.getView().addUserMessage(n,0),a=!0);var h=$this.getView().response_mCSBcontainer,u=o.parents(".vishnu-response-message:first"),l=u.next(".vishnu-empty-box");void 0!==o&&a&&(h.find(".vishnu-inf-message").removeClass("vishnu-last-message"),o.addClass("vishnu-last-message"),u.insertAfter(h.children().last()),l.insertAfter(u)),$this.getView().updateHeight(e($this.getView().response_scrolled),e($this.getView().classInfMessage+".vishnu-last-message",$this.getView().idResponseText,$this.getView().container))}i.Cookie.hasCookie("operatorRateShow")&&i.getView().initOperatorRate()}),this.on(e.fn.vishnu.VishnuEvent.REQUEST,function(e,t){$this.LCEModel&&$this.LCEModel.rateShown||$this.getView().addUserMessage(t)}),this.on(e.fn.vishnu.VishnuEvent.SHOW,function(){$this.getView().updateHeight(e($this.getView().response_scrolled),"bottom",0)}),s.apply(this,arguments),e.fn.vishnu.settings[e.fn.vishnu.uuid].LCEModel.enabled&&this.getLCEModel().init(e.fn.vishnu.settings[e.fn.vishnu.uuid].LCEModel),this.on(e.fn.vishnu.VishnuEvent.V3G_OPERATOR_CHAT_RATED,function(t,s){i.getModel().sendRequest(e.fn.vishnu.VishnuEvent.srvReq.OPERATOR_SESSION_CLOSED,{w_operator:""})})},e.fn.vishnu.Tracker=function(e){this.prefix="vishnu"+e.number+".",this.Vishnu=e},e.fn.vishnu.Tracker.prototype={Vishnu:null,account:!1,accounts:{},prefix:"",trackCookiePath:null,trackDomainName:null,_ready:!1,_yaCounter:null,init:function(e){for(var t in e)t in this&&(this[t]=e[t]);if(this.accounts&&0!==this.accounts.length&&(""!==this.accounts.GA||""!==this.accounts.YA)&&(this.accounts.hasOwnProperty("GA")&&("undefined"==typeof _gat&&"undefined"==typeof _gaq&&function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),_gaq="undefined"!=typeof _gaq?_gaq:[],this._ready=!0,this.track(["_setAccount",this.account]),this.postInit(),this.track(["_trackPageview"])),this.accounts.hasOwnProperty("YA"))){var i="yaCounter"+this.accounts.YA;if(window.hasOwnProperty(i))this._yaCounter=window[i],this._ready=!0;else{this.Vishnu.log("TRACKER: \u0421\u0447\u0435\u0442\u0447\u0438\u043a\u0430 \u043d\u0435\u0442 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435, \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u0441\u0430\u043c\u0438!");var s=this;!function(e,t,n){(window[n]=window[n]||[]).push(function(){try{window[i]=new Ya.Metrika({id:1*s.accounts.YA,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0}),s._yaCounter=window[i],s._ready=!0}catch(e){}});var o=e.getElementsByTagName("script")[0],a=e.createElement("script"),r=function(){o.parentNode.insertBefore(a,o)};a.type="text/javascript",a.async=!0,a.src="https://mc.yandex.ru/metrika/watch.js","[object Opera]"==window.opera?e.addEventListener("DOMContentLoaded",r,!1):r()}(document,window,"yandex_metrika_callbacks")}}},postInit:function(){this.track(["_setAllowLinker",!0]),"string"==typeof this.trackDomainName?this.track(["_setDomainName",this.trackDomainName]):this.track(["_setDomainName","auto"]),"string"==typeof this.trackCookiePath&&this.track(["_setCookiePath",this.trackCookiePath])},track:function(e){if(this._ready)if(this.accounts.hasOwnProperty("YA")){var t,i=0,s=[],n={};if("_trackEvent"!==e[0]&&"Error"!==e[0])return;for(var o in e)e[o]&&""!==e[o]&&null!==e[o]&&"_trackEvent"!==e[o]&&"boolean"!=typeof e[o]&&i<3&&s.push(e[o]),"object"!=typeof e[o]&&3!==i||(n=e[o]),i++;t=s.join(": ").toLowerCase(),!0===this.Vishnu.debugMode&&(console.group("TRACKER: "),console.log(t),console.log(n),console.groupEnd()),this._yaCounter&&this._yaCounter.reachGoal(t,n)}else{if("object"==typeof e&&"_trackEvent"===e[0])for(var a=e.length;a<=5;a++)a<5?e[a]=null:5==a&&(e[a]=!0);this.prefix&&"object"==typeof e&&"string"==typeof e[0]&&(e[0]=this.prefix+e[0]),_gaq.push(e)}}},e.fn.vishnu.Tracker=function(e){this.prefix="vishnu"+e.number+".",this.Vishnu=e},e.fn.vishnu.Tracker.prototype={Vishnu:null,account:!1,accounts:{},prefix:"",trackCookiePath:null,trackDomainName:null,_ready:!1,_yaCounter:null,init:function(e){for(var t in e)t in this&&(this[t]=e[t]);if(this.accounts&&0!==this.accounts.length&&(""!==this.accounts.GA||""!==this.accounts.YA)&&(this.accounts.hasOwnProperty("GA")&&("undefined"==typeof _gat&&"undefined"==typeof _gaq&&function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),_gaq="undefined"!=typeof _gaq?_gaq:[],this._ready=!0,this.track(["_setAccount",this.account]),this.postInit(),this.track(["_trackPageview"])),this.accounts.hasOwnProperty("YA")))if(window.hasOwnProperty("yaCounter"+this.accounts.YA))this._yaCounter=window["yaCounter"+this.accounts.YA],this._ready=!0;else{this.Vishnu.log("TRACKER: \u0421\u0447\u0435\u0442\u0447\u0438\u043a\u0430 \u043d\u0435\u0442 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435, \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u0441\u0430\u043c\u0438!");var i=this;!function(e,t,s){(window[s]=window[s]||[]).push(function(){try{window.yaCounter46460022=new Ya.Metrika({id:46460022,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0}),i._yaCounter=window["yaCounter"+i.accounts.YA],i._ready=!0}catch(e){}});var n=e.getElementsByTagName("script")[0],o=e.createElement("script"),a=function(){n.parentNode.insertBefore(o,n)};o.type="text/javascript",o.async=!0,o.src="https://mc.yandex.ru/metrika/watch.js","[object Opera]"==window.opera?e.addEventListener("DOMContentLoaded",a,!1):a()}(document,window,"yandex_metrika_callbacks")}},postInit:function(){this.track(["_setAllowLinker",!0]),"string"==typeof this.trackDomainName?this.track(["_setDomainName",this.trackDomainName]):this.track(["_setDomainName","auto"]),"string"==typeof this.trackCookiePath&&this.track(["_setCookiePath",this.trackCookiePath])},track:function(e){if(this._ready)if(this.accounts.hasOwnProperty("YA")){if(null==this._yaCounter)return;var t,i=0,s=[],n={};if("_trackEvent"!==e[0]&&"Error"!==e[0])return;for(var o in e)e[o]&&""!==e[o]&&null!==e[o]&&"_trackEvent"!==e[o]&&"boolean"!=typeof e[o]&&i<3&&s.push(e[o]),"object"!=typeof e[o]&&3!==i||(n=e[o]),i++;t=s.join(": ").toLowerCase(),!0===this.Vishnu.debugMode&&(console.group("TRACKER: "),console.log(t),console.log(n),console.groupEnd()),this._yaCounter.reachGoal(t,n)}else{if("object"==typeof e&&"_trackEvent"===e[0])for(var a=e.length;a<=5;a++)a<5?e[a]=null:5==a&&(e[a]=!0);this.prefix&&"object"==typeof e&&"string"==typeof e[0]&&(e[0]=this.prefix+e[0]),_gaq.push(e)}}},e.fn.vishnu.Vishnu.prototype.getLCEModel=function(){return this.LCEModel||(this.LCEModel=new e.fn.vishnu.LCEModel(this)),this.LCEModel},e.fn.vishnu.Model.prototype.sendNotifyLog=function(t,i,s){var n={notification_id:s,notifications:"object"==typeof i&&i?i:[]},o=this,a={cuid:t,euid:this.Event.NOTIFICATION,context:n},r=this.Net.url+"Chat.event";e.ajax({type:"POST",url:r,data:e.fn.vishnu.JSON.stringify(a),dataType:"json",success:function(e){e=e&&e.result?e.result:e,o.Net._handlerEvent(e,o.Event.NOTIFICATION)}})};var n=e.fn.vishnu.Model.prototype.onInit;e.fn.vishnu.Model.prototype.onInit=function(t){var i=this;this.getCUID()!==t.cuid&&(this.Vishnu.log("newCUID (true)"),this.Cookie.getCookie("dialogStarted")&&this.Cookie.setCookie("dialogStarted","",-1)),this.Vishnu.Model._sendNotifyLogCallback=function(){delete i.Vishnu.Model._sendNotifyLogCallback;var s=i.Vishnu.getView(),n=e(s.idButton).data("dataForIframe");if(n&&null!==n){var o=JSON.parse(n.notifyText),a=n.notifyId;if(this.notifyClickID=a,"object"==typeof o&&o){this.sendNotifyLog(t.cuid,o,a);var r=o[o.length-1];this.Vishnu.getHistory().response({text:{value:r.msg}}),this.Vishnu.getView().addInfMessage(r.msg,0)}}},n.apply(this,arguments),this.Cookie.getCookie("new_chat")&&this.Vishnu.getHistory().clean()},e.fn.vishnu.Model.prototype.onResponse=function(t,i,s){if(i&&"function"==typeof this.Vishnu.Model._sendNotifyLogCallback&&this.Vishnu.Model._sendNotifyLogCallback(),t){t.isEvent=void 0!==i&&i,t.euid=s,!t.isEvent&&t.cuid&&this.setCUID(t.cuid);t.context&&this.processingVar(t,"processBeforeResponse");this.mode();e.fn.vishnu.VishnuModes.INF!==this.mode()&&void 0!==this.mode()||!t.context||t.context.hasOwnProperty("liveperson")||this.Vishnu.trigger(e.fn.vishnu.VishnuEvent.RESPONSE,t),t.context&&this.processingVar(t,"processAfterResponse")}else this.Vishnu.track(["_trackEvent","Error","Bad response"])},e.fn.vishnu.Model.prototype.processingVar=function(t,i){if("object"==typeof t){var s=this,n=this.Vishnu.View;switch(i){case"processBeforeResponse":break;case"processAfterResponse":if(t.context&&t.context.hasOwnProperty("wflag_uploadcare_enabled")&&("true"===t.context.wflag_uploadcare_enabled?(this.Cookie.hasCookie("upload-enabled")||this.Cookie.setCookie("upload-enabled",1,365),e(n.idAttachment,this.container).show(),this.enableUpload()):"false"===t.context.wflag_uploadcare_enabled&&(e(n.idAttachment,this.container).hide(),this.Cookie.setCookie("upload-enabled",0,-1))),t.context&&t.context.hasOwnProperty("wcmd")){var o=t.context.wcmd;switch(t.context.wcmd){case"CHECK-OPERATORS":s.Vishnu.trigger("nns_v3g_switchToOperatorRequested");try{var a=setTimeout(function(){throw new SyntaxError("\u041e\u0428\u0418\u0411\u041a\u0410! \u0414\u0430\u043d\u043d\u044b\u0435 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 \u043d\u0435 \u043f\u0440\u0438\u0448\u043b\u0438 \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0438 2\u0445 \u0441\u0435\u043a\u0443\u043d\u0434.")},2e3);s.Vishnu.on("nns_v3g_livechatStatusRequested",function(t,i){clearTimeout(a),s.Vishnu.Target.off("nns_v3g_livechatStatusRequested"),console.debug("\u043f\u043e\u043b\u0443\u0447\u0435\u043d \u043e\u0442\u0432\u0435\u0442 \u043d\u0430 nns_v3g_livechatStatusRequested",i);var n=1*i.freeOperatorsCount;s.sendRequest(e.fn.vishnu.VishnuEvent.srvReq.WCMD_RESULT,{w_cmd:o,w_result:"ok",w_status:n})})}catch(t){return console.warn(t),void s.sendRequest(e.fn.vishnu.VishnuEvent.srvReq.WCMD_RESULT,{w_cmd:o,w_result:"fail"})}break;case"CONNECT-TO-OPERATOR":s.mode(e.fn.vishnu.VishnuModes.LIVE_CHAT)}}break;case"processBeforeRate":t.context&&void 0!==t.context.inline_message&&(e(this.idRate,this.container).is(":visible")&&e(this.idRate,this.container).after('<div class="vishnu-empty-box"><p><br/></p></div>'),this.Vishnu.getView().setText(text,t)),t.context&&void 0!==t.context.inline_message&&e($this.idRate).next(".vishnu-empty-box").remove();break;default:return}}};var o=e.fn.vishnu.Model.prototype.sendRequest;e.fn.vishnu.Model.prototype.sendRequest=function(t,i){var s=this.Vishnu.getView(),n=e(s.idButton).data("dataForIframe");"number"==typeof(n&&null!==n?n.notifyId:null)&&this.Vishnu.getView().firstRequest&&!this.Cookie.getCookie("dialogStarted")&&(this.Vishnu.trigger("nns_dialogIsStarted"),this.Cookie.setCookie("dialogStarted",1,365),this.notifyClickID=null),o.call(this,t,i)},e.fn.vishnu.View.prototype.uploadText="\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d \u0444\u0430\u0439\u043b",e.fn.vishnu.View.prototype.idAttachment="#vishnu-attach-file-container",e.fn.vishnu.View.prototype.attachmentTpl='<div id="vishnu-attach-file-container"><input id="vishnu-attach-file" name="screenshot" type="hidden" role="uploadcare-uploader" data-crop="" data-tabs="file" data-public-key="%UPLOADCARE_PUBLIC_KEY" /></div>',e.fn.vishnu.Model.prototype.enableUpload=function(){var t=this,i=this.Vishnu.getView();if(0===e(i.idAttachment).length){e(i.idSend).before(i.attachmentTpl.replace("%UPLOADCARE_PUBLIC_KEY",UPLOADCARE_PUBLIC_KEY));var s=setInterval(function(){if("undefined"!=typeof uploadcare&&(clearInterval(s),!this.uploadcareWidgets)){this.uploadcareWidgets=uploadcare.initialize();var i=uploadcare.SingleWidget("[role=uploadcare-uploader]");i.onChange(function(e){e&&e.done(function(e){}).fail(function(e,t){console.error("!!!!! UPLOAD FAIL",e,t)})}),i.onUploadComplete(function(t){this.Vishnu.log(t);var s=this.Vishnu.getModel().mode(),n=t.originalUrl,o=t.name?t.name:"\u0444\u0430\u0439\u043b";s===e.fn.vishnu.VishnuModes.INF?this.sendRequest(e.fn.vishnu.VishnuEvent.srvReq.ATTACHMENT,{w_att_type:"file",w_att_url:n,w_attachment_file_name:o}):s===e.fn.vishnu.VishnuModes.LIVE_CHAT&&this.Vishnu.getLCEModel().sendRequest("\u041f\u043e\u043b\u0443\u0447\u0435\u043d \u0444\u0430\u0439\u043b: "+(t.name?t.name+" ":"")+n),this.Vishnu.getView().addInfMessage(this.Vishnu.getView().uploadText+" <a href='"+n+"' target='_blank'>"+o+"</a>"),this.Vishnu.getHistory().response({text:{value:this.Vishnu.getView().uploadText+" <a href='"+n+"' target='_blank'>"+o+"</a>"}}),i.value(null)}.bind(t))}},100)}},e.fn.vishnu.View.prototype.idHeader="#vishnu-header",e.fn.vishnu.View.prototype.idResponse="#vishnu-response",e.fn.vishnu.View.prototype.idDialog="#vishnu-dialog",e.fn.vishnu.View.prototype.adaptiveResize=function(t){var i,s,n,o,a;i=e(window).outerHeight(),s=e(window).outerWidth(),this.isMobile&&(i<121||(i>s?(this.Vishnu.log("PORTRAIT"),o=i-2*(n=Math.round(7*i/100))-1):(this.Vishnu.log("LANDSCAPE"),o=i-2*(n=Math.round(10*i/100))-10,e(this.idResponse,this.container).css({"margin-bottom":"10px"})),a=Math.round(.8*i/100),e(this.idClose,this.container).css({top:n/6,padding:n/2+"px "+n/3+"px "+n/2+"px "+n/3+"px"}),e(this.idHeader,this.container).css({height:n,"line-height":n+2+"px","padding-left":"70px"}),e(this.idRequest,this.container).css({height:n,"max-height":n,padding:a}),e(this.idSend,this.container).css({top:n/2}),e(this.idRequestWrap,this.container).css({height:n-2*a}),e(this.idInput+","+this.idInput+":focus",this.container).css({"line-height":n-4*a+"px",height:n-2*a,"min-height":n-2*a,padding:a+" 0 "+a+" 12px"}),e(this.idResponseText,this.container).css({height:"100%","max-height":o}),e(this.idResponse,this.container).css({height:o}),e(this.idDialog,this.container).css({top:n}),void 0===t&&this.updateHeight(this.response_scrolled,e(this.classInfMessage+".vishnu-last-message",this.idResponseText,this.container))))};var a=e.fn.vishnu.View.prototype.draw;e.fn.vishnu.View.prototype.draw=function(){a.apply(this,arguments);var t=this,i=this.defaultInputText;e(window).on("resize touchend",function(e){t.adaptiveResize(e)}),e(this.idInput,this.container).unbind("keypress"),e(this.idInput,this.container).keypress(function(s){if(e(this).val()===i&&(e(this).val(""),e(this).removeClass("vishnu-placeholder-default")),13===s.keyCode){s.preventDefault(),t._sendRequest();var n=e(this);setTimeout(function(){n.click()},10)}return t.Vishnu.trigger(e.fn.vishnu.VishnuEvent.USER_ACTIVITY),e(this).val().length<=e(this).attr("maxlength")}).val(i).addClass("vishnu-placeholder-default").click(function(){e(this).val()===i&&(e(this).val(""),e(this).removeClass("vishnu-placeholder-default"))}),e(this.idInput,this.container).unbind("blur"),e(this.idInput,this.container).on("blur",function(t){""===e(this).val()&&e(this).addClass("vishnu-placeholder-default").val(i)}),window.addEventListener("orientationchange",function(e){t.adaptiveResize(e)},!1)},e.fn.vishnu.View.prototype.playAnimation=function(t){if(this.Vishnu.getModel().mode()===e.fn.vishnu.VishnuModes.INF&&!this.noCharacter)if(this.isFlashEnabled())try{this.getFlash().playAnimation(t.type)}catch(e){}else this._playAnimation(t.type)},e.fn.vishnu.View.prototype._sendRequest=function(){if(!e(this.container).hasClass("vishnu-input-block")){var t=e(this.idInput,this.container).attr("maxlength")||1e3,i=e(this.idInput,this.container).val().substr(0,t);this.isText(i)&&i!==this.defaultInputText&&(this.Vishnu.trigger(e.fn.vishnu.VishnuEvent.REQUEST,i.split('"').join("'")),e(this.idInput,this.container).hide().val("").show().focus(),setTimeout(function(){e(this.idInput,this.container).focus()},10))}},e.fn.vishnu.View.prototype.setText=function(e,t){this.isText(e)&&this.addInfMessage(e)},e.fn.vishnu.View.prototype.addInfMessage=function(t,i){if(""!==t){i=void 0!==i?i:950;var s=null;return t=/uploaded-file/gim.test(t)?e("<div/>").html(t).text():t,s=e('<div class="vishnu-response-message"><div class="vishnu-inf-message vishnu-last-message"><div class="vishnu-text">'+t+'</div></div></div><div class="vishnu-empty-box"><p><br/></p></div>'),this.isScrollable?(e(this.classInfMessage,this.idResponseText,this.container).removeClass("vishnu-last-message"),e(this.response_mCSBcontainer).append(s),this.updateHeight(this.response_scrolled,e(this.classInfMessage+".vishnu-last-message",this.idResponseText,this.container),i)):(e(this.idResponseText,this.container).removeClass("vishnu-last-message"),e(this.idResponseText,this.container).html(s)),s}},e.fn.vishnu.View.prototype.addUserMessage=function(t,i){if(this.isScrollable){t=e("<div/>").text(t).html(),i=void 0!==i?i:950;var s=null;return s=e('<div class="vishnu-response-message"><div class="vishnu-user-message vishnu-last-message"><div class="vishnu-text">'+t+'</div></div></div><div class="vishnu-empty-box"><p><br/></p></div>'),this.isScrollable?(e(this.classUserMessage,this.idResponseText,this.container).removeClass("vishnu-last-message"),e(this.response_mCSBcontainer).append(s),this.updateHeight(this.response_scrolled,"bottom",0)):(e(this.idResponseText,this.container).removeClass("vishnu-last-message"),e(this.idResponseText,this.container).html(s)),s}},e.fn.vishnu.View.prototype.addTehMessage=function(t,i,s){if(""!==t){s=void 0!==s&&s,t=e("<div/>").html(t).html(),i=void 0!==i?i:10;var n=null;return n=e('<div class="vishnu-response-message"><div class="vishnu-teh-message vishnu-last-message"><div class="vishnu-text">'+t+"</div></div></div>"),this.isScrollable&&(e(".vishnu-teh-message",this.idResponseText,this.container).removeClass("vishnu-last-message"),e(this.response_mCSBcontainer).find(".vishnu-response-message:last > .vishnu-teh-message").length&&!s?e(this.response_mCSBcontainer).find(".vishnu-response-message:last").replaceWith(n):e(this.response_mCSBcontainer).append(n),this.updateHeight(this.response_scrolled,"bottom",0)),n}},e.fn.vishnu.View.prototype.showTyping=function(e){},e.fn.vishnu.View.prototype.updateHeight=function(t,i,s){if("object"==typeof t){i=void 0!==i?i:"bottom",s="number"==typeof s?s:950,e(t).mCustomScrollbar("update"),e(t).mCustomScrollbar("scrollTo",i,{scrollInertia:s})}},e.fn.vishnu.View.prototype._lockScroll=function(e){e.addEventListener?(e.addEventListener("DOMMouseScroll",e.onmousewheel=function(e){e.preventDefault()},!1),e.addEventListener("touchmove",e.touchmove=function(e){e.preventDefault()},!1)):(e.onmousewheel=function(e){window.event.returnValue=!1},e.touchmove=function(e){window.event.returnValue=!1})},e.fn.vishnu.View.prototype._unlockScroll=function(e){e.removeEventListener?(e.removeEventListener("DOMMouseScroll",e.onmousewheel,!1),e.onmousewheel=null,e.removeEventListener("touchmove",e.touchmove,!1),e.touchmove=null):(e.onmousewheel=null,e.touchmove=null)};var r=e.fn.vishnu.View.prototype.showVishnu;e.fn.vishnu.View.prototype.showVishnu=function(t){r.apply(this,arguments);var i=this.Vishnu.getModel(),s=this.Vishnu.getView();if(i.initAlreadySended&&i.getCUID()){var n=e(s.idButton).data("dataForIframe");if(!n||null===n)return;var o=JSON.parse(n.notifyText),a=n.notifyId;if("object"==typeof o&&o){i.sendNotifyLog(i.getCUID(),o,a),_selfNotify.removeLSData(_selfNotify.lsNames.textKey);var h=o[o.length-1];this.Vishnu.getHistory().response({text:{value:h.msg}}),this.addInfMessage(h.msg,0)}}};var h=e.fn.vishnu.View.prototype.hideVishnu;e.fn.vishnu.View.prototype.hideVishnu=function(){h.apply(this,arguments)};var u=e.fn.vishnu.View.prototype.setResponseText;e.fn.vishnu.View.prototype.setResponseText=function(e,t,i){t.context&&t.context.hasOwnProperty("wcmd")&&t.context.hasOwnProperty("wflag_hide_reply")&&1==t.context.wflag_hide_reply||u.apply(this,arguments)},e.fn.vishnu.View.prototype.blockTextarea=function(t){var i=e(this.idRequest,this.container),s=e(this.idInput,this.container);t?(i.addClass("vishnu-blocked"),s.attr("disabled","disabled"),s.trigger("blur"),s.val("")):(i.removeClass("vishnu-blocked"),s.removeAttr("disabled"),s.trigger("focus"),s.trigger("click"),this.History.get())},e.fn.vishnu.View.prototype.idOperatorRate="#vishnu-operator-rate",e.fn.vishnu.View.prototype.idOperatorRateHelloTxt="#vishnu-operator-rate-text",e.fn.vishnu.View.prototype.classOperatorRateStar=".vishnu-star",e.fn.vishnu.View.prototype.classOperatorRateStarSel="selected",e.fn.vishnu.View.prototype.idOperatorRateThanksTxt="#vishnu-operator-rate-thanks",e.fn.vishnu.View.prototype.operatorRateHideTimeout=5e3,e.fn.vishnu.View.prototype.operatorRateForm={tpl:'<div id="vishnu-operator-rate" ><div id="vishnu-operator-rate-text">{%helloText}</div><div id="vishnu-operator-rate-details"><a href="#" class="vishnu-star" data-rate="1">1</a><a href="#" class="vishnu-star" data-rate="2">2</a><a href="#" class="vishnu-star" data-rate="3">3</a><a href="#" class="vishnu-star" data-rate="4">4</a><a href="#" class="vishnu-star" data-rate="5">5</a></div><div id="vishnu-operator-rate-thanks" style="display:none;">{%thanksText}</div></div>',helloText:"\u041f\u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043e\u0446\u0435\u043d\u043a\u0443 \u043f\u043e \u043f\u044f\u0442\u0438\u0431\u0430\u043b\u044c\u043d\u043e\u0439 \u0448\u043a\u0430\u043b\u0435",thanksText:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e! \u041c\u044b \u0431\u0443\u0434\u0435\u043c \u0441\u0442\u0430\u0440\u0430\u0442\u044c\u0441\u044f \u0443\u043b\u0443\u0447\u0448\u0438\u0442\u044c \u043d\u0430\u0448 \u0441\u0435\u0440\u0432\u0438\u0441"},e.fn.vishnu.View.prototype._operatorRateHandlers={hover:function(){var t=e(event.target).data("rate"),i=this;e(this.classOperatorRateStar,this.idOperatorRate).removeClass(this.classOperatorRateStarSel),e(this.classOperatorRateStar,this.idOperatorRate).each(function(s,n){e(n).data("rate")<=t&&e(n).addClass(i.classOperatorRateStarSel)})},click:function(){var t=this,i=e(event.target).data("rate");e(this.classOperatorRateStar,this.idOperatorRate,this.container).off("mouseenter"),this.Vishnu.trigger("toMibew::operatorRateSend",i),this.Vishnu.trigger(e.fn.vishnu.VishnuEvent.V3G_OPERATOR_CHAT_RATED,i),e(this.idOperatorRateThanksTxt,this.idOperatorRate).show(),this.updateHeight(this.response_scrolled,"bottom"),setTimeout(function(){t._operatorRateHandlers.close.apply(t)},t.operatorRateHideTimeout)},close:function(){e(this.idOperatorRate,this.container).off(),e(this.idOperatorRate,this.container).remove(),this.stop_announce=!1,this.blockTextarea(!1),this.Cookie.hasCookie("operatorRateShow")&&this.Cookie.setCookie("operatorRateShow",0,-1),this.Vishnu.getModel().INC.clearInactiveTimer(),this.updateHeight(this.response_scrolled,"bottom")}},e.fn.vishnu.View.prototype.initOperatorRate=function(){if(!(e(this.idOperatorRate,this.container).length>0)){this.stop_announce=!0,this.blockTextarea(!0),this.Cookie.hasCookie("operatorRateShow")||this.Cookie.setCookie("operatorRateShow",1,365);var t=e(this.operatorRateForm.tpl.replace("{%helloText}",this.operatorRateForm.helloText).replace("{%thanksText}",this.operatorRateForm.thanksText));this.isScrollable?e(this.response_mCSBcontainer).append(t):e(this.idResponseText,this.container).append(t),e(this.idOperatorRate,this.idResponseText,this.container).show(),this.updateHeight(this.response_scrolled,e(this.idOperatorRate,this.idResponseText,this.container)),e(this.classOperatorRateStar,this.idOperatorRate,this.container).on("mouseenter",this._operatorRateHandlers.hover.bind(this)),e(this.classOperatorRateStar,this.idOperatorRate,this.container).on("click",this._operatorRateHandlers.click.bind(this)),e(this.idOperatorRate,this.container).show()}};var l=e.fn.vishnu.Rate.prototype.draw;e.fn.vishnu.Rate.prototype.draw=function(){l.apply(this,arguments);var t=this;e(this.idRateYes,this.container).unbind("click"),e(this.idRateNo,this.container).unbind("click"),e(this.idRateDetails+" a",this.container).unbind("click"),e(this.idRateYes,this.container).click(function(){e(t.idRate,t.container).removeClass("detailShowed"),e(t.idRateYes+","+t.idRateNo,t.container).removeClass("notsel").removeClass("selected"),e(this).addClass("selected"),e(t.idRateNo,t.container).addClass("notsel"),t.answered||(t.answered=!0,t.Vishnu.trigger(e.fn.vishnu.VishnuEvent.RATE,5))}),e(this.idRateNo,this.container).click(function(){e(t.idRate,t.container).addClass("detailShowed"),e(t.idRateYes+","+t.idRateNo,t.container).removeClass("notsel").removeClass("selected"),e(this).addClass("selected"),e(t.idRateYes,t.container).addClass("notsel"),t.answered||(t.Vishnu.track(["_trackEvent","Inf","Rate","No"]),t.showDetails())}),e(this.idRateDetails+" a",this.container).click(function(i){i.preventDefault(),t.answered||(e(t.idRate,t.container).removeClass("detailShowed"),t.answered=!0,t.Vishnu.trigger(e.fn.vishnu.VishnuEvent.RATE,e(this).attr("rel")))})},e.fn.vishnu.Rate.prototype.show=function(){var t=this.Vishnu.getView();this.shown=!0,this.answered=!1,e(this.idRateYes+","+this.idRateNo,this.container).removeClass("notsel"),e(this.idRate,this.container).show(),t.isScrollable?(e(this.idRateText).html(this.defaultRateText),e(t.response_mCSBcontainer).append(e(this.idRate,this.container))):e(t.idResponseText,t.container).append(e(this.idRate,this.container)),t.updateHeight(t.response_scrolled,e(t.classInfMessage+".vishnu-last-message",t.idResponseText,t.container)),this.Vishnu.track(["_trackEvent","Inf","Rate","Show"])};var d=e.fn.vishnu.Rate.prototype.close;e.fn.vishnu.Rate.prototype.close=function(){d.apply(this,arguments),e(this.idRateText,this.container).show(),e(this.idRateClose,this.container).show(),e(this.idRateYes,this.container).show(),e(this.idRateNo,this.container).show(),this.Vishnu.getView().updateHeight()},e.fn.vishnu.Rate.prototype.closeTimeout=7e3,e.fn.vishnu.Rate.prototype.showThanks=function(t){text=void 0!==t&&void 0!==t.text&&t.text.value.length>0?t.text.value:this.defaultThanksText,text=this.Vishnu.getView().replaceMarks(text,t.token),t.animation&&t.animation.type&&this.Vishnu.getView().playAnimation(t.animation),e(this.idRateDetails,this.container).is(":visible")&&e(this.idRateDetails,this.container).hide();var i=this,s=this.Vishnu.getModel();if(t.context&&s.processingVar(t,"processBeforeRate"),0===t.context.length){e(this.idRateText,this.container).hide(),e(this.idRateYes,this.container).hide(),e(this.idRateNo,this.container).hide(),e(this.idRateThanks,this.container).html(text).show();var n=t.token;e(this.idRateThanks,this.container).find(".vishnu-userlink").click(function(){return i.Vishnu.trigger(e.fn.vishnu.VishnuEvent.REQUEST,e(this).text()),i.Vishnu.track(["_trackEvent","Inf","Rate userlink click",e(this).text()]),!1}).end().find(".vishnu-click").click(function(){i.Vishnu.trigger(e.fn.vishnu.VishnuEvent.LINK_CLICK,n),i.Vishnu.track(["_trackEvent","Inf","Rate link click",e(this).attr("href")])}).each(function(){i.Vishnu.track(["_trackEvent","Inf","Rate link show",e(this).attr("href")])}),this.Vishnu.getView().updateHeight(e(this.Vishnu.getView().response_scrolled),"bottom")}setTimeout(function(){i.close()},this.closeTimeout)},e.fn.vishnu.Rate.prototype.showDetails=function(){var t=this.Vishnu.getView();e(this.idRateDetails,this.container).show(),t.isScrollable?(e(this.idRateText).html(this.defaultRateText),e(t.response_mCSBcontainer).append(e(this.idRate,this.container))):e(t.idResponseText,t.container).append(e(this.idRate,this.container)),t.updateHeight(t.response_scrolled,e(this.idRate,this.container))},e.fn.vishnu.History.prototype.request=function(e){this.Vishnu.getView().textForUser&&null!==this.Vishnu.getView().textForUser&&(e=this.Vishnu.getView().textForUser);var t=this.get();t.push({user:e,ts:(new Date).getTime()}),t.length>this.length&&t.splice(0,t.length-this.length),this.save(t)},e.fn.vishnu.History.prototype.response=function(e){var t=this.get();"notification"!==e.id&&(t&&t.length>0&&t[t.length-1].inf&&t[t.length-1].inf.replace(/<\/?[^>]+>/g,"")===e.text.value.replace(/<\/?[^>]+>/g,"")||(e.context&&e.context.hasOwnProperty("wflag_hide_reply")&&1==e.context.wflag_hide_reply?this.Vishnu.log("HISTORY (flags): wflag_hide_reply = 1"):(this.Vishnu.getView().removeLinkFromMessage&&(e.text.value=e.text.value.replace(/<\/?[^>]+>/g,""),this.Vishnu.getView().removeLinkFromMessage=!1),t.push({inf:e.text.value,ts:(new Date).getTime()}),t.length>this.length&&t.splice(0,t.length-this.length),this.save(t))))}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery);